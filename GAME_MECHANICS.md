# Игровые механики

## Общая концепция
Игрок сражается с волнами зомби на двухмерной арене размером примерно 2000×1200 единиц. Карта генерируется системой `GenerateMapSystem`: по периметру создаются стены, в произвольных точках появляются валуны, а также несколько точек спауна противников и стартовая зона игрока. Основная цель — выживать как можно дольше, зарабатывая опыт и отражая всё усиливающиеся волны врагов.

## Управление персонажем
- Передвижение осуществляется по схеме WASD; поддерживаются русские клавиши-аналоги (Ф, Ы, В, Ц).
- Базовая скорость, задаваемая `PlayerControlSystem`, составляет 200 единиц в секунду.
- Нажатие `Enter` ставит игру на паузу; смерть игрока активирует «жёсткую» паузу, пока не перезапустить матч.

## Автоматический огонь и снаряды
- Игрок постоянно отслеживает ближайшего противника в радиусе 100 единиц. При наличии цели герой автоматически стреляет.
- При выстреле создаётся `ProjectileEntity`: снаряд стартует из позиции игрока, летит со скоростью 600 единиц в секунду и живёт до 2 секунд.
- Каждый снаряд несёт урон (по умолчанию 100 из настроек игрока) и уничтожается после столкновения с целью или препятствием.

## Вражеский ИИ и поведение
- Базовые противники — `ZombieEntity`, использующие настройки `regularZombie`: радиус агро 1800, скорость 60, урон 10, здоровье 300+10×уровень, опыт за убийство 20.
- Состояния ИИ (`AISystem`): `idle`, `chase`, `attack`. Пока игрок далеко, враг стоит; в пределах агро-радиуса преследует, а в пределах дистанции атаки (45 единиц) наносит урон с учётом кулдауна (1,2 с).
- При гибели враг прекращает движение, затем обрабатывается системой урона.

## Волны и боссы
- Система `SpawnSystem` запускает последовательные волны. Размер первой волны — 30 врагов; каждая следующая увеличивается в 1,35 раза (округление в большую сторону, минимум 30).
- Противники появляются пакетами не более 10 единиц за спаун, при этом учитывается ограничение по текущему количеству врагов рядом с точкой.
- Каждые 8 секунд возможен дополнительный «бросок» до 8 врагов, чтобы ускорить прохождение волны.
- Каждая пятая волна дополняется боссом `BossEntity`: радиус агро 500, скорость 30 + 3×уровень, урон 40, базовое здоровье 500 + 150×уровень, опыт за убийство 500.

## Боёвка, столкновения и препятствия
- `CollisionSystem` отслеживает пересечения круговых коллайдеров. Снаряды и враги, соприкасаясь, наносят урон через `DamageComponent`.
- Столкновения игрока с врагами или врагов друг с другом отрабатывают отталкивание, чтобы избежать наложения.
- Стены и валуны помечены как препятствия; игрок не может проходить сквозь блокирующие объекты.

## Здоровье и урон
- Все сущности с компонентом `HealthComponent` имеют текущее (`hp`) и максимальное (`maxHp`) здоровье.
- Система `DamageSystem` вычитает нанесённый урон и при достижении 0 hp удаляет сущность из мира.
- Если погибает игрок, шлётся событие `playerKilled`, останавливающее игровой цикл.

## Добыча и опыт
- При смерти врага, если у него задан `xpReward`, создаётся лут `createLoot` с типом `xp` и количеством, равным награде.
- Подбор лута игроком (фиксируется столкновением) генерирует событие `xpCollected`.
- `ExperienceSystem` хранит накопленный опыт, уровень и порог до следующего уровня. При наборе нужного значения XP уменьшается на величину порога, уровень увеличивается на 1, а следующий порог возрастает на 25%.

## Эффекты состояний
- Компонент `EffectComponent` поддерживает временные эффекты: урон/лечение по времени, ускорение (×1,1) и замедление (×0,9).
- Эффекты тикают раз в 1 секунду и автоматически снимаются по окончании длительности.

## Отрисовка и камера
- `RenderSystem` рисует сущности на canvas: если есть спрайт, используется анимация, иначе — цветовые квадраты по категориям.
- Над всеми объектами с здоровьем отображается индикатор, цвет которого зависит от процента hp.
- Камера (`CameraSystem`) центрирует вид вокруг игрока и ограничивает его границами мира.

## События хаба
- Центральная шина событий (`EventBus`) оповещает системы о ключевых событиях: спаун/смерть врагов, сбор опыта, повышение уровня, гибель игрока.
- Это позволяет системам (спавн волн, опыт, рендер UI) реагировать асинхронно и без прямых связей.

> Документ основан на актуальном состоянии исходного кода в каталоге `packages/client/src/engine` на момент подготовки файла.
